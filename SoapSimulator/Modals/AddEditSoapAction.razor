<EditForm Model="@Model" OnInvalidSubmit='()=>Error("Fill in all required fields")' OnValidSubmit="Save">
    <DataAnnotationsValidator />
    <MudDialog>
        <DialogContent>
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudTextField ReadOnly="View" Variant="Variant.Outlined" @bind-Value="@Model.MethodName" Label="Unique Action Name" For="()=>Model.MethodName" />
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudTextField ReadOnly="View" Variant="Variant.Outlined" @bind-Value="@Model.Description" Label="Description" For="()=>Model.Description" />
                </MudItem>
                <MudItem xs="12">
                    <MudText Align="Align.Center" Typo="Typo.h6">Request Format</MudText>
                    <MudDivider />
                    <MudTextField ReadOnly Required Lines="6" @bind-Value="@Model.Request.Body" Variant="Variant.Outlined" Label="Enter sample request XML." />
                </MudItem>
                <MudItem xs="12">
                    
                </MudItem>
            </MudGrid>
        </DialogContent>
        <DialogActions>
            <MudButton OnClick="()=>Dialog.Cancel()">Close</MudButton>
            <MudButton ButtonType="ButtonType.Submit" StartIcon="@Icons.Material.Filled.Save" Color="Color.Success">Save</MudButton>
        </DialogActions>
    </MudDialog>
</EditForm>
@code {
    [CascadingParameter]
    MudDialogInstance Dialog { get; set; }
    [Parameter]
    public SoapAction? Model { get; set; }
    [Parameter]
    public bool View { get; set; }
    protected override void OnInitialized()
    {
        if (!View)
        {
            Model = new();
        }
    }
    void Error(string error) => snackBar.Add(error, Severity.Error);
    async Task Save()
    {   

        Model.MethodName = Model.MethodName.Trim();      
        if (string.IsNullOrEmpty(Model.Request.Body))
        {
            Error("Please provide a sample request xml.");
            return;
        }
        var validateReq = xmlValidator.IsValidXml(Model.Request.Body);      
        if (!validateReq.IsValid)
        {
            Error("Request XML Error: " + validateReq.Message);
            return;
        }         
        if (View)
        {
            await configurationService.UpdateActionAsync(Model);
            snackBar.Add($"Action {Model.MethodName} updated.",Severity.Success);
            Dialog.Close(null);
            return;
        }
        Dialog.Close(Model);
    }
}
